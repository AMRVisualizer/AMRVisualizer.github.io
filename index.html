<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="">
    <meta name="author" content="">

    <title>AMR Visualizer</title>

    <link rel="stylesheet" href="css/cartodb.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

    <link rel="icon" type="image/png" href="./AMR-icon-simple.png">
<!--   <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@0.4.9/dist/leaflet.draw.css" />
 -->  
 <link href="https://fonts.googleapis.com/css?family=Carrois+Gothic+SC|Nunito" rel="stylesheet">
<!--   <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css" /> -->
  <link rel="stylesheet" type="text/css" href="css/leaflet.css" />
  </head>

  <style>
html, body, #container {
  height: 100%;
  width: 100%;
  overflow: hidden;
}

body {
  padding-top: 50px;
}

#map {
  width: auto;
  height: 100%;   
font-family: 'Carrois Gothic SC', sans-serif;
}


.list-group-item:hover {
    background: steelblue;
    color: #fff;
    cursor: pointer;

}

/* basic positioning */
.legend { 
    list-style: none; 
    width: 200px;
    height: 400px;
    left: -100px;
}

.legend li { 
    float: left; 
    margin-right: 0px; 
    width: 200px;
    margin-left: -35px;
  font-family: 'Nunito', sans-serif;
}

.legend ul { 

}

.legend span { 
    border-radius: 3px;
    border: none;
    float: left; 
    width: 25px; 
    height: 25px; 
    margin: 3px; 
    align-items: vertical;
    font-family: 'Carrois Gothic SC', sans-serif;
}


/* LEGEND COLORS */
.legend .a { 
  background-color: #50B848; 
}
.legend .b { 
  background-color: #BCDDA1; 
}
.legend .c { 
  background-color: #F4E6ED; 
}
.legend .d { 
  background-color: #EDC1DB; 
}
.legend .e { 
  background-color: #CF3D96; 
}
.legend .f { 
  background-color: #CCCCCC; 
}

.col-md-2 {
  background: #0A0A0A;
  width: 200px;
}

p {
  color: grey;    
  font-family: 'Carrois Gothic SC', sans-serif;
}

li {
  color: grey;
  font-size: 9pt;    
  font-family: 'Nunito', sans-serif;

}

.hey {
  background-color: white;
  font-family: 'Nunito', sans-serif;
}

.hey:hover {
  background-color: #e9e9e9;
  font-family: 'Nunito', sans-serif;
}

.navbar-brand {
  font-family: 'Nunito', sans-serif;
  color: black;

}

.navbar-brand:hover { 
    background-color: #e9e9e9;
    color: black;
}

.active {
    background-color: #e9e9e9;
    color: black;
}

a {
  font-family: 'Nunito', sans-serif;
  color: black;
}

a:hover {
    background-color: #e9e9e9;
    color: black;
}

.navbar-left {
float:left;
margin: 10px;
}

/*font-family: 'Adamina', serif;
font-family: 'Nunito', sans-serif;
font-family: 'Arimo', sans-serif;
font-family: 'Cabin', sans-serif;
font-family: 'Josefin Sans', sans-serif;
font-family: 'Baloo Bhai', cursive;
font-family: 'Duru Sans', sans-serif;
font-family: 'Carrois Gothic SC', sans-serif;
font-family: 'Gruppo', cursive;

*/
/*// Colors:
// #50B848
// #BCDDA1
// #F4E6ED
// #EDC1DB
// #CF3D96
*/

  </style>

  <body>

    <nav class="navbar navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="button navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a href="#" class="navbar-left"><img src="AMR-icon.png"></a>
          <a class="navbar-brand" href="#">E. Coli Antimicrobial Resistance Visualizer</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="./index.html">Map</a></li>
            <li><a href="./about.html">About</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div> <!-- end container -->
    </nav> <!-- end navbar-->
<div id="container">
  <div class="col-md-2" style="height:100%">
    <br/>
    <ul id="results" class="list-group"></ul>
    </br></br>
      <!-- start year dropdown -->
      <div class="dropdown">
        <p>YEAR</p>
        <button class="btn btn-dark dropdown-toggle hey" type="button" data-toggle="dropdown">2015
        <span class="caret"></span></button>
        <ul class="dropdown-menu">
          <li id = "2009drop" class="selection-class"><a href="#">2009</a></li>
          <li id = "2013drop" class="selection-class"><a href="#">2013</a></li>
          <li id = "2015drop" class="selection-class"><a href="#">2015</a></li>
        </ul>
      </div>
      <!-- end year dropdown -->
      </br></br>
      </br></br>

        <!-- start drug dropdown -->
        <div class="dropdown">
         <p>ANTIBIOTIC</p>
          <button class="btn btn-dark dropdown-toggle hey" type="button" data-toggle="dropdown">Ciprofloxacin
          <span class="caret"></span></button>
          <ul class="dropdown-menu">
            <li id ="amxdrop" class="selection-class"><a href="#">Amoxicillin</a></li>
            <li id ="tridrop" class="selection-class"> <a href="#">Trimethroprim</a></li>
            <li id ="cipdrop" class="selection-class"><a href="#">Ciprofloxacin</a></li>
            <li id ="nitdrop" class="selection-class"><a href="#">Nitrofurantoin</a></li>
            <li id ="ampdrop" class="selection-class"><a href="#">Ampicillin</a></li>
            <li id ="ampsdrop" class="selection-class"><a href="#">Ampicillin/Sulbactam</a></li>
            <li id ="levdrop" class="selection-class"> <a href="#">Levofloxacin</a></li>
          </ul>
        </div>
        <!-- end drug dropdown-->

      </br></br>
      </br></br>

<!-- start legend -->
<div class = "dropdown">
  <p>SUSCEPTIBILITY</p>
  <ul class="legend">
        <li><span class="a"></span>   90 - 100%</li>
      </br>
        <li><span class="b"></span>   80 - 89% </li>
      </br>
        <li><span class="c"></span>   70 - 79%</li>
      </br>
        <li><span class="d"></span>   60 - 69%</li>
      </br>
        <li><span class="e"></span>   Under 60%</li>
        </br>
        <li><span class="f"></span>   No Data </li>
      </ul>
</div>
<!-- end legend -->

</div>

      <!-- map div -->
      <div id="map"></div>
      <!-- end map div -->
<div class="container">
      <footer class="footer">
        <p>&copy; 2018, Natalee Desotell.</p>
      </footer>
</div>



</script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.2.0/mustache.min.js'></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="./js/cartodb.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script>

var sql2;
var polygon;
var currentYear = 2015;
var currentDrug = "Ciprofloxacin";



///////////////////////////////////////////////////////////
//////////////////COLORS///////////////////////////////////
///////////////////////////////////////////////////////////

// 2009 COLORS // 
var cip09colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [cip09 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [cip09 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [cip09 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [cip09 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [cip09 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';


var nit09colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [nit09 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [nit09 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [nit09 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [nit09 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [nit09 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';

var amp09colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [amp09 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [amp09 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [amp09 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [amp09 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [amp09 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';


var amps09colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [amps09 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [amps09 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [amps09 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [amps09 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [amps09 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';


var amx09colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [amx09 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [amx09 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [amx09 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [amx09 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [amx09 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';


var tri09colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [tri09 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [tri09 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [tri09 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [tri09 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [tri09 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';

var lev09colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [lev09 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [lev09 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [lev09 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [lev09 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [lev09 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';

// 2013 COLORS // 

var cip13colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [cip13 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [cip13 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [cip13 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [cip13 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [cip13 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';


var nit13colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [nit13 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [nit13 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [nit13 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [nit13 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [nit13 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';

var amp13colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [amp13 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [amp13 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [amp13 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [amp13 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [amp13 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';


var amps13colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [amps13 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [amps13 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [amps13 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [amps13 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [amps13 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';



var amx13colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [amx13 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [amx13 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [amx13 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [amx13 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [amx13 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';

var tri13colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [tri13 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [tri13 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [tri13 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [tri13 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [tri13 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';

var lev13colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [lev13 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [lev13 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [lev13 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [lev13 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [lev13 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';

// 2015 COLORS // 

var cip15colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [cip15 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [cip15 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [cip15 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [cip15 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [cip15 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';

var nit15colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [nit15 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [nit15 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [nit15 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [nit15 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [nit15 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';

var amp15colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [amp15 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [amp15 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [amp15 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [amp15 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [amp15 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';

var amps15colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [amps15 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [amps15 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [amps15 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [amps15 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [amps15 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';


var amx15colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [amx15 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [amx15 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [amx15 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [amx15 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [amx15 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';


var tri15colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [tri15 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [tri15 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [tri15 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [tri15 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [tri15 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';

var lev15colors = '#layer {' +
        'polygon-fill: #CCCCCC;' +
        'polygon-opacity: 1;' +
        '::outline {' +
        'line-color: #FFFFFF;' +
        'line-width: 1;' +
        'line-opacity: 0.5;' +
        '}' +
      '}' +
      '#layer [lev15 <= 100] {' +
        'polygon-fill: #50B848;' +
      '}' +
      '#layer [lev15 <= 89] {' +
        'polygon-fill: #BCDDA1;' +
      '}' +
      '#layer [lev15 <= 79] {' +
        'polygon-fill: #F4E6ED;' +
      '}' +
      '#layer [lev15 <= 69] {' +
        'polygon-fill: #EDC1DB;' +
      '}' +
      '#layer [lev15 <= 59] {' +
        'polygon-fill: #CF3D96;' +
      '}';


// END LAYER COLORS

///////////////////////////////////////////////////////////
///////////////// LOAD MAP //// ///////////////////////////
///////////////////////////////////////////////////////////

  //jquery document ready statement (wraps all JS), prevents jQuery code from running before the document is finished loading 
  $( document ).ready(function() {


//keep users from panning around & losing WI view
var southWest = L.latLng(41.428714, -93.343035),
    northEast = L.latLng(47.900777, -85.535404),
    bounds = L.latLngBounds(southWest, northEast);


var hospIcon = L.icon({
    iconUrl: 'hospital-icon.png',
    iconSize:     [15 , 15], // size of the icon
    iconAnchor:   [15, 15], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -10] // point from which the popup should open relative to the iconAnchor
});

var cityIcon = L.icon({
    iconUrl: 'city-icon.png',
    iconSize:     [15, 20], // size of the icon
    iconAnchor:   [5, 10], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -10] // point from which the popup should open relative to the iconAnchor
});


var madisonIcon= L.icon({
    iconUrl: 'madison-icon.png',
    iconSize:     [50, 20], // size of the icon
    iconAnchor:   [5, 10], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -10] // point from which the popup should open relative to the iconAnchor
});

var milwaukeeIcon= L.icon({
    iconUrl: 'milwaukee-icon.png',
    iconSize:     [60, 20], // size of the icon
    iconAnchor:   [58, 10], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -10] // point from which the popup should open relative to the iconAnchor
});

var lacrosseIcon= L.icon({
    iconUrl: 'lacrosse-icon.png',
    iconSize:     [55, 22], // size of the icon
    iconAnchor:   [0, 10], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -10] // point from which the popup should open relative to the iconAnchor
});

var wausauIcon= L.icon({
    iconUrl: 'wausau-icon.png',
    iconSize:     [50, 20], // size of the icon
    iconAnchor:   [58, 10], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -10] // point from which the popup should open relative to the iconAnchor
});

var greenbayIcon= L.icon({
    iconUrl: 'greenbay-icon.png',
    iconSize:     [60, 20], // size of the icon
    iconAnchor:   [58, 10], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -10] // point from which the popup should open relative to the iconAnchor
});

var appletonIcon= L.icon({
    iconUrl: 'appleton-icon.png',
    iconSize:     [60, 20], // size of the icon
    iconAnchor:   [58, 10], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -10] // point from which the popup should open relative to the iconAnchor
});

var eauclaireIcon= L.icon({
    iconUrl: 'eauclaire-icon.png',
    iconSize:     [60, 20], // size of the icon
    iconAnchor:   [58, 10], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -10] // point from which the popup should open relative to the iconAnchor
});
//   var dataSources = L.layerGroup();
// // need to create a list of wisconsin hospitals
  var cities = L.layerGroup();
  L.marker([43.0731, -89.4012], {icon: madisonIcon}).addTo(cities);
  L.marker([43.0389, -87.9065], {icon: milwaukeeIcon}).addTo(cities);  
  L.marker([43.8014, -91.2396], {icon: lacrosseIcon}).addTo(cities);
  L.marker([44.9591, -89.6301], {icon: wausauIcon}).addTo(cities);
  L.marker([44.5192, -88.0198], {icon: greenbayIcon}).addTo(cities);
  L.marker([44.2619, -88.4154], {icon: appletonIcon}).addTo(cities);  
  L.marker([44.8113, -91.4985], {icon: eauclaireIcon}).addTo(cities);



//   L.marker([45.4013481, -91.8493118], {icon: hospIcon}).bindPopup('Barron County Labs').addTo(dataSources),
//   L.marker([44.4746819, -87.9923935], {icon: hospIcon}).bindPopup('Brown County').addTo(dataSources),
//   L.marker([43.2, -90.5], {icon: hospIcon}).bindPopup('Hospital 789').addTo(dataSources);

    
    //Create the leaflet map
    var map = L.map('map', {
      zoomControl: false,
      center: [44.8,-90.0],
      zoom: 7,
      layers: [cities],
      maxBounds: bounds,
      minZoom: 7,
      maxZoom: 8

    });



  var overlays = {
    // "Hospitals": hospitals,
    "Cities": cities
  };

  L.control.layers(null, overlays).addTo(map);


    L.control.zoom({
      position:'topright'
    }).addTo(map);

    var currentYear = 2015;
    var currentDrug = "Ciprofloxacin";
    var username = "nrobson";
    var currentMap = "cip15";
    
    var layer = "";

    var nit09Layer = "";
    var nit13Layer = "";
    var nit15Layer = "";

    var cip09Layer = "";
    var cip13Layer = "";
    var cip15Layer = "";

    var lev09Layer = "";
    var lev13Layer = "";
    var lev15Layer = "";

    var tri09Layer = "";
    var tri13Layer = "";
    var tri15Layer = "";

    var amx09Layer = "";
    var amx13Layer = "";
    var amx15Layer = "";

    var amp09Layer = "";
    var amp13Layer = "";
    var amp15Layer = "";

    var amps09Layer = "";
    var amps13Layer = "";
    var amps15Layer = "";

    var cip09;
    var nit09;
    var tri13 = "";
    var nit09;
    showCip();
    //show Ciprofloxacin 2015 on load
    
    sql2 = new cartodb.SQL({ user: username, format: 'geojson' });
    
    
    var basemap =L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_nolabels/{z}/{x}/{y}.png', {
  attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
  subdomains: 'abcd',
    }).addTo(map);


///////////////////////////////////////////////////////////
///////////////// DROPDOWNS /// ///////////////////////////
///////////////////////////////////////////////////////////


    // have the dropdown display the currently selected year and drug
    $(".dropdown-menu li a").click(function(){
    $(this).parents(".dropdown").find('.btn').html($(this).text() + ' <span class="caret"></span>');
    $(this).parents(".dropdown").find('.btn').val($(this).data('value'));
  });


    $("#tridrop").click(function(e){
    currentDrug = "Trimethroprim";
    showTri();
    // console.log(currentDrug + " was clicked");
    e.preventDefault();
    });

    $("#cipdrop").click(function(e){
    currentDrug = "Ciprofloxacin";
    showCip();
    // console.log(currentDrug + " was clicked");
    e.preventDefault();
    });


    $("#ampdrop").click(function(e){
    currentDrug = "Ampicillin";
    showAmp();
    // console.log(currentDrug + " was clicked");
    e.preventDefault();
    });

    $("#ampsdrop").click(function(e){
    currentDrug = "Ampicillin-Sulbactam";
    showAmps();
    // console.log(currentDrug + " was clicked");
    e.preventDefault();
    });



    $("#amxdrop").click(function(e){
    currentDrug = "Amoxicillin";
    showAmx();
    // console.log(currentDrug + " was clicked");
    e.preventDefault();
    });

    $("#levdrop").click(function(e){
    currentDrug = "Levofloxacin";
    showLev();
    // console.log(currentDrug + " was clicked");
    e.preventDefault();
    });

    $("#nitdrop").click(function(e){
    currentDrug = "Nitrofurantoin";
    showNit();
    // console.log(currentDrug + " was clicked");
    // e.preventDefault();
    });

    $("#2009drop").click(function(e){
    currentYear = 2009;
    selectDrug();
    console.log(currentDrug);
    // console.log("current year is " + currentYear)
    // e.preventDefault();
    });

    $("#2013drop").click(function(e){
    currentYear = 2013;
    selectDrug();
    // console.log(currentDrug);
    // console.log("current year is " + currentYear)
    // e.preventDefault();
    });

    $("#2015drop").click(function(e){
    currentYear = 2015;
    selectDrug();
    // console.log(currentDrug);
    // console.log("current year is " + currentYear)
    // e.preventDefault();
    });



$(".selection-class").click(function(e){ // CS: I assigned a "selection-class" to each of the dropdown buttons (in their HTML, above) so that they each will trigger this function when clicked 
  resetSelections()
})
function resetSelections(){
    if (polygon) {
        map.removeLayer(polygon); // CS: "polygon" is a layer object that gets assigned the GeoJSON of the selected feature... we should remove it from the map each time the map gets redrawn. 
    }
}

function selectDrug() {
  // console.log("selectDrug was called");
if (currentDrug === "Nitrofurantoin") {
    // console.log(currentDrug + " was called");
    showNit();
} else if (currentDrug === "Trimethroprim") {
    // console.log(currentDrug + " was called");
    showTri();
} else if (currentDrug === "Ciprofloxacin") {
    // console.log(currentDrug + " was called");
    showCip();
} else if (currentDrug === "Levofloxacin") {
    // console.log(currentDrug + " was called");
    showLev();
} else if (currentDrug === "Amoxicillin") {
    // console.log(currentDrug + " was called");
    showAmx();
} else if (currentDrug === "Ampicillin") {
    // console.log(currentDrug + " was called");
    showAmp();
} else if (currentDrug === "Ampicillin-Sulbactam") {
    // console.log(currentDrug + " was called");
    showAmps();
} else {
  console.log("Error selecting drug")
}
};

///////////////////////////////////////////////////////////
///////////////// MAP FUNCTIONS ///////////////////////////
///////////////////////////////////////////////////////////

function removePrevious() {
    if (cip09Layer != ""){
    cip09Layer.getSubLayer(0).hide();
    cip09Layer = "";
    map.closePopup();

    console.log("hid cip09Layer");

} if (cip13Layer != "") {
    cip13Layer.getSubLayer(0).hide();
    cip13Layer = "";
    map.closePopup();

    console.log("hid cip13Layer");
} if (cip15Layer != "") {
    cip15Layer.getSubLayer(0).hide();
    cip15Layer = "";
    map.closePopup();

    console.log("hid cip15Layer");
} if (amx09Layer != "") {
    amx09Layer.getSubLayer(0).hide();
    amx09Layer = "";
    map.closePopup();

    console.log("hid amx09Layer");
} if (amx13Layer != "") {
    amx13Layer.getSubLayer(0).hide();
    amx13Layer = "";
    map.closePopup();

    console.log("hid amx13Layer");
} if (amx15Layer != "") {
    amx15Layer.getSubLayer(0).hide();
    amx15Layer = "";
    map.closePopup();

    console.log("hid amx15Layer");
} if (tri09Layer != "") {
    tri09Layer.getSubLayer(0).hide();
    tri09Layer = "";
    map.closePopup();

    console.log("hid tri09Layer");
} if (tri13Layer != "") {
    tri13Layer.getSubLayer(0).hide();
    tri13Layer = "";
    map.closePopup();

    console.log("hid tri13Layer");
} if (tri15Layer != "") {
    tri15Layer.getSubLayer(0).hide();
    tri15Layer = "";
    map.closePopup();

    console.log("hid tri15Layer");
} if (amp09Layer != "") {
    amp09Layer.getSubLayer(0).hide();
    amp09Layer = "";
    map.closePopup();
    console.log("hid amp09Layer");
} if (amp13Layer != "") {
    amp13Layer.getSubLayer(0).hide();
    amp13Layer = "";
    map.closePopup();
    console.log("hid amp13Layer");

} if (amp15Layer != "") {
    amp15Layer.getSubLayer(0).hide();
    amp15Layer = "";
    map.closePopup();
    console.log("hid amp15Layer");

} if (amps09Layer != "") {
    amps09Layer.getSubLayer(0).hide();
    amps09Layer = "";
    map.closePopup();
    console.log("hid amps09Layer");

} if (amps13Layer != "") {
    amps13Layer.getSubLayer(0).hide();
    amps13Layer = "";
    map.closePopup();
    console.log("hid amps13Layer");

} if (amps15Layer != "") {
    amps15Layer.getSubLayer(0).hide();
    amps15Layer = "";
    map.closePopup();
    console.log("hid amps15Layer");

} if (nit09Layer != "") {
    nit09Layer.getSubLayer(0).hide();
    nit09Layer = "";
    map.closePopup();

    console.log("hid nit09Layer");
} if (nit13Layer != "") {
    nit13Layer.getSubLayer(0).hide();
    nit13Layer = "";
    map.closePopup();

    console.log("hid nit13Layer");
} if (nit15Layer != "") {
    nit15Layer.getSubLayer(0).hide();
    nit15Layer = "";
    map.closePopup();

    console.log("hid nit15Layer");
} if (lev09Layer != "") {
    lev09Layer.getSubLayer(0).hide();
    lev09Layer = "";
    map.closePopup();

    console.log("hid lev09Layer");
} if (lev13Layer != "") {
    lev13Layer.getSubLayer(0).hide();
    lev13Layer = "";
    map.closePopup();

    console.log("hid lev13Layer");
} if (lev15Layer != "") {
    lev15Layer.getSubLayer(0).hide();
    tri15Layer = "";
    map.closePopup();

    console.log("hid lev15Layer");
} else {
    console.log("didn't hide any layers");
}

};


function showAmx() {
if (currentYear === 2009) {
    currentMap = "amx09";
    // console.log(currentMap);
    // console.log("Amoxicillin 2009 function called");
    removePrevious();
    var amx09 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: amx09colors,
      interactivity: ['cartodb_id', 'amx09'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      amx09Layer = layer;
      // layer.bind('featureOver', onPolyOver)
      // layer.bind('featureOut', onPolyOut)
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureAmx09(data.cartodb_id);

      });
    })
 ;
} else if (currentYear === 2013) {
    currentMap = "amx13";
    // console.log(currentMap);
    // console.log("Amoxicillin 2013 function called");
    removePrevious();
    var amx13 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: amx13colors,
      interactivity: ['cartodb_id', 'amx13'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      amx13Layer = layer;
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureAmx13(data.cartodb_id);
      });
    })
 ;
} 
else if (currentYear === 2015) {
    currentMap = "amx15";
    // console.log(currentMap);
    // console.log("Amoxicillin 2015 function called");
    removePrevious();
    var amx15 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: amx15colors,
      interactivity: ['cartodb_id', 'amx15'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      amx15Layer = layer;
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureAmx15(data.cartodb_id);
      });
    })
    ;
} else {
    console.log("error");
}
};

function showCip() {
if (currentYear === 2009) {
    currentMap = "cip09";
    // console.log(currentMap);
    // console.log("Ciprofloxacin 2009 function called");
    removePrevious();
    var currentDrug = "Ciprofloxacin";
    var cip09 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: cip09colors,
      interactivity: ['cartodb_id', 'cip09'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      cip09Layer = layer;
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureCip09(data.cartodb_id);
      });
    })
 ;
} else if (currentYear === 2013) {
    currentMap = "cip13";
    // console.log(currentMap);
    // console.log("Ciprofloxacin 2013 function called");
    removePrevious();
    var currentDrug = "Ciprofloxacin";
    var cip13 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: cip13colors,
      interactivity: ['cartodb_id', 'cip13'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      cip13Layer = layer;
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureCip13(data.cartodb_id);
      });
    })

 ;
} 
else if (currentYear === 2015) {
    currentMap = "cip15";
    // console.log(currentMap);
    // console.log("Ciprofloxacin 2015 function called");
    removePrevious();
    var currentDrug = "Ciprofloxacin";
    var cip15 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: cip15colors,
      interactivity: ['cartodb_id', 'cip15'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      cip15Layer = layer;
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureCip15(data.cartodb_id);
      });
    })
    ;
} else {
    console.log("error");
}
};




function showAmps() {

if (currentYear === 2009) {
    currentMap = "amps09";
    // console.log(currentMap);
    // console.log("Ampicillin 2009 function called");
    removePrevious();
    var currentDrug = "Ampicillin-Sulbactam";
    var amps09 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: amps09colors,
      interactivity: ['cartodb_id', 'amps09'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      amps09Layer = layer;
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureAmps09(data.cartodb_id);
      });
    })
 ;
} else if (currentYear === 2013) {
    currentMap = "amps13";
    // console.log(currentMap);
    // console.log("Ampicillin 2013 function called");
    removePrevious();
    var amps13 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: amps13colors,
      interactivity: ['cartodb_id', 'amps13'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      amps13Layer = layer;
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureAmps13(data.cartodb_id);
      });
    })

 ;
} 
else if (currentYear === 2015) {
    currentMap = "amps15";
    // console.log(currentMap);
    // console.log("Ampicillin 2015 function called");
    removePrevious();
    var amps15 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: amps15colors,
      interactivity: ['cartodb_id', 'amps15'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      amps15Layer = layer;
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureAmps15(data.cartodb_id);
      });
    })
    ;
} else {
    console.log("error");
}
};


function showAmp() {

if (currentYear === 2009) {
    currentMap = "amp09";
    // console.log(currentMap);
    // console.log("Ampicillin 2009 function called");
    removePrevious();
    var currentDrug = "Ampicillin";
    var amp09 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: amp09colors,
      interactivity: ['cartodb_id', 'amp09'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      amp09Layer = layer;
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureAmp09(data.cartodb_id);
      });
    })
 ;
} else if (currentYear === 2013) {
    currentMap = "amp13";
    // console.log(currentMap);
    // console.log("Ampicillin 2013 function called");
    removePrevious();
    var amp13 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: amp13colors,
      interactivity: ['cartodb_id', 'amp13'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      amp13Layer = layer;
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureAmp13(data.cartodb_id);
      });
    })

 ;
} 
else if (currentYear === 2015) {
    currentMap = "amp15";
    // console.log(currentMap);
    // console.log("Ampicillin 2015 function called");
    removePrevious();
    var amp15 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: amp15colors,
      interactivity: ['cartodb_id', 'amp15'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      amp15Layer = layer;
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureAmp15(data.cartodb_id);
      });
    })
    ;
} else {
    console.log("error");
}
};

//SHOW NITROFURANTOIN
function showNit() {
if (currentYear === 2009) {
    currentMap = "nit09";    
    // console.log(currentMap);
    // console.log("Nitrofurantoin 2009 function called");
    removePrevious();
    var nit09 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: nit09colors,
      interactivity: ['cartodb_id', 'nit09'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      nit09Layer = layer;
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureNit09(data.cartodb_id);
      });
    })
 ;
} else if (currentYear === 2013) {
    currentMap = "nit13";
    // console.log(currentMap);
    // console.log("Nitrofurantoin 2013 function called");
    removePrevious();
    var nit13 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: nit13colors,
      interactivity: ['cartodb_id', 'nit13'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      nit13Layer = layer;
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureNit13(data.cartodb_id);
      });
    })
 ;
} 
else if (currentYear === 2015) {
    currentMap = "nit15";
    // console.log(currentMap);
    // console.log("Nitrofurantoin 2015 function called");
    removePrevious();
    var nit15 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: nit15colors,
      interactivity: ['cartodb_id', 'nit15'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      nit15Layer = layer;
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureNit15(data.cartodb_id);
      });
    })
    ;
} else {
    console.log("error");
}
};

//SHOW TRIMETHROPRIM
function showTri() {
if (currentYear === 2009) {
    currentMap = "tri09";
    // console.log(currentMap);
    // console.log("Trimethroprim 2009 function called");
    removePrevious();
    var tri09 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: tri09colors,
      interactivity: ['cartodb_id', 'tri09'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      tri09Layer = layer;
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureTri09(data.cartodb_id);
      });
    })
 ;
} else if (currentYear === 2013) {
    currentMap = "tri13";
    // console.log(currentMap);
    // console.log("Trimethroprim 2013 function called");
    removePrevious();
    var tri13 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: tri13colors,
      interactivity: ['cartodb_id', 'tri13'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      tri13Layer = layer;
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureTri13(data.cartodb_id);
      });
    })
 ;
} 
else if (currentYear === 2015) {
    currentMap = "tri15";
    // console.log(currentMap);
    // console.log("Trimethroprim 2015 function called");
    removePrevious();
    var tri15 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: tri15colors,
      interactivity: ['cartodb_id', 'tri15'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      tri15Layer = layer;
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureTri15(data.cartodb_id);
      });
    })
    ;
} else {
    console.log("error");
}
};


//SHOW LEVOFLOXACIN
function showLev() {
if (currentYear === 2009) {
    currentMap = "lev09";
    // console.log(currentMap);
    // console.log("Levofloxacin 2009 function called");
    removePrevious();
    var lev09 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: lev09colors,
      interactivity: ['cartodb_id', 'lev09'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      lev09Layer = layer;
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureLev09(data.cartodb_id);
      });
    })
 ;
} else if (currentYear === 2013) {
    currentMap = "lev13";
    // console.log(currentMap);
    // console.log("Levofloxacin 2013 function called");
    removePrevious();
    var lev13 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: lev13colors,
      interactivity: ['cartodb_id', 'lev13'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      lev13Layer = layer;
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureLev13(data.cartodb_id);
      });
    })
 ;
} 
else if (currentYear === 2015) {
    currentMap = "lev15";
    // console.log(currentMap);
    // console.log("Levofloxacin 2015 function called");
    removePrevious();
    var lev15 = cartodb.createLayer(map, {
    user_name: username,
    type: 'cartodb',
    sublayers: [{
      sql: 'SELECT * FROM amrviz',
      cartocss: lev15colors,
      interactivity: ['cartodb_id', 'lev15'],
      layerIndex:1
    }]
    },{ https: true })
    .addTo(map)
    .done(function(layer) {
      layer.setInteraction(true);
      //layer.bind('featureOver', onPolyOver)
      //layer.bind('featureOut', onPolyOut)
      lev15Layer = layer;
      layer.bind('featureClick', onPolyClick)
      layer.bind('featureClick',function(e, pos, latlng, data) {
        showFeatureLev15(data.cartodb_id);
      });
    })
    ;
} else {
    console.log("error");
}
};

function updateTitle() {

// a function to update the title with currentYear and currentDrug

};



///////////////////////////////////////////////////////////
///////////////// LEGEND ////// ///////////////////////////
///////////////////////////////////////////////////////////

// QUESTION: what does this 'd' refer to?
function getColor(d) {
    return d > 1000 ? '#800026' :
           d > 500  ? '#BD0026' :
           d > 200  ? '#E31A1C' :
           d > 100  ? '#FC4E2A' :
           d > 50   ? '#FD8D3C' :
           d > 20   ? '#FEB24C' :
           d > 10   ? '#FED976' :
                      '#FFEDA0';
}

// // function to draw the legend
// function drawLegend(cartodb_id) {
// // console.log("drawlegend")
// var legend = L.control({position: 'bottomleft'});
// legend.onAdd = function (map) {
//     var div = L.DomUtil.create('div', 'info legend'),
//         grades = [0, 10, 20, 50, 100, 200, 500, 1000],
//         labels = [];
//     // loop through our density intervals and generate a label with a colored square for each interval
//     for (var i = 0; i < grades.length; i++) {
//         div.innerHTML +=
//             '<i style="background:' + getColor(grades[i] + 1) + '"></i> ' +
//             grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
//     }
//     return div;
// };
// legend.addTo(map);
//     var legend = $('.legend').html("<h3>Susceptible</h3></br></br><ul>");     
// }

function onPolyClick(e, latln, pxPos, data, layer){
    // console.log(data)
  }


///////////////////////////////////////////////////////////
/////////////////////// TOOLTIPS //////////////////////////
///////////////////////////////////////////////////////////

// NITROFURANTOIN 2009 TOOLTIP
function showFeatureNit09(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.nit09) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.nit09 + "% Susceptible "
};

      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }
  // AMPICILLIN 2009 TOOLTIP
function showFeatureAmp09(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.amp09) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.amp09 + "% Susceptible "
};

      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }


  function showFeatureAmps09(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.amps09) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.amps09 + "% Susceptible "
};

      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }


  // AMOXICILLIN 2009 TOOLTIP
function showFeatureAmx09(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.amx09) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.amx09 + "% Susceptible "
};

      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }
  // TRIMETHROPRIM 2009 TOOLTIP
function showFeatureTri09(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.tri09) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.tri09 + "% Susceptible "
};

      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }

// CIPROFLOXACIN 2009 TOOLTIP
function showFeatureCip09(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.cip09) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.cip09 + "% Susceptible "
};

      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }

// LEVOFLOXACIN 2009 TOOLTIP
function showFeatureLev09(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.lev09) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.lev09 + "% Susceptible "
};

      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }

///2013 Tooltips
// NITROFURANTOIN 2013 TOOLTIP
function showFeatureNit13(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.nit13) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.nit13 + "% Susceptible "
};

      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }
  // AMPICILLIN 2013 TOOLTIP
function showFeatureAmp13(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.amp13) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.amp13 + "% Susceptible "
};
      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }

  function showFeatureAmps13(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.amps13) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.amps13 + "% Susceptible "
};
      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }



  // AMOXICILLIN 2013 TOOLTIP
function showFeatureAmx13(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.amx13) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.amx13 + "% Susceptible "
};
      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }

  // TRIMETHROPRIM 2013 TOOLTIP
function showFeatureTri13(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.tri13) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.tri13 + "% Susceptible "
};
      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }



// CIPROFLOXACIN 2013 TOOLTIP
function showFeatureCip13(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.cip13) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.cip13 + "% Susceptible "
};
      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }
// LEVOFLOXACIN 2013 TOOLTIP
function showFeatureLev13(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.lev13) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.lev13 + "% Susceptible "
};
      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }

//2015 tooltips
// NITROFURANTOIN 2015 TOOLTIP
function showFeatureNit15(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.nit15) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.nit15 + "% Susceptible "
};
      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }

  // AMPICILLIN 2015 TOOLTIP
function showFeatureAmp15(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.amp15) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.amp15 + "% Susceptible "
};
      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }

  // AMPICILLIN 2015 TOOLTIP
function showFeatureAmps15(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.amps15) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.amps15 + "% Susceptible "
};
      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }


  // AMOXICILLIN 2015 TOOLTIP
function showFeatureAmx15(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.amx15) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.amx15 + "% Susceptible "
};
      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }

  // TRIMETHROPRIM 2015 TOOLTIP
function showFeatureTri15(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.tri15) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.tri15 + "% Susceptible "
};
      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }

// CIPROFLOXACIN 2015 TOOLTIP
function showFeatureCip15(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.cip15) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.cip15 + "% Susceptible "
};
      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }


// LEVOFLOXACIN 2015 TOOLTIP
function showFeatureLev15(cartodb_id) {
    sql2.execute("SELECT * from amrviz WHERE cartodb_id = {{cartodb_id}}", {cartodb_id: cartodb_id} 
  ).done(function(geojson) {
      if (polygon) {
        map.removeLayer(polygon);
      }
// set initial value for popupText
var popupText = "<b>" + geojson.features["0"].properties.name + " County " + "</b></br>" + "No Data"
// if this feature contains a value (i.e., isn't null), then change the value of popupText
if (geojson.features["0"].properties.lev15) {
    popupText = "<b>" + geojson.features["0"].properties.name + " County </b> </br>" +  geojson.features["0"].properties.lev15 + "% Susceptible "
};
      polygon = L.geoJson(geojson, { 
        style: {
        color: "#000",
        fillColor: "#fff",
        fillOpacity: 0.0,
        weight: 2,
        opacity: 0.65
        }
      }).addTo(map).bindPopup(popupText).openPopup();
      // //prints just the value I click
      // console.log(geojson.features["0"].properties.amp09);
    });
  }

  }); // ends on document ready context 




///////////////////////////////////////////////////////////
///////////////// STOCK CODE // ///////////////////////////
///////////////////////////////////////////////////////////
  
  // Stock code for enabling map queries against CARTO server
  var Map = cdb.core.View.extend({
    initialize: function() {
      //CS: console.log("Map.initialize")
      _.bindAll(this, '_initMap');
      this.filters = this.options.filters;
      this._getVizJson();
      this._bindEvents();
    },

    _getVizJson: function() {
      $.ajax({
      url: 'data.json',
      success: this._initMap,
      error: function() {
        cdb.log.info('problems getting vizjson info, check tools.json url please')
      }
      })
    },

    _initMap: function(data) {
      var self = this;
      cartodb.createVis(this.$el, data.vizjson, {search: true})
      .done(function(vis, layers) {
        self.layers = layers[1];
        self.map = vis.getNativeMap();
        var v = cdb.vis.Overlay.create('search', map.viz, {});
      });
    },

    _bindEvents: function() {
      this.filters.bind('change', this._changeLayerGroup, this);
    },

    _changeLayerGroup: function(layers) {
      var self = this;

      _.each(layers, function(opts, i) {
      var pos = i.split('-')[1];
      var sublayer = self.layers.getSubLayer(pos);

      if (sublayer) {
        sublayer.set(opts);
      }
      });
    }
  })
  // More stock code
  var Filters = cdb.core.View.extend({
    initialize: function() {
      //CS: console.log("Filters.initialize")
      _.bindAll(this, 'render');
      this._getActions();
    },
    render: function(data) {
      this.clearSubViews();
      var self = this;
      if (!data.interactions) return false;
      var buttons = data.interactions;
      for (var i = 0, l = buttons.length; i < l; i++) {
      var a = new FiltersItem({ data: buttons[i] });
      a.bind('change', this._triggerChange, this)
      self.addView(a);
      self.$('ul').append(a.render().el);
      }
      return this;
    },

    _triggerChange: function(d) {
      this._setSelectedFilter(d);
      this.trigger('change', d.layers, this);
    },

    _setSelectedFilter: function(d) {
      this.$('ul li a').removeClass('selected');
      this.$('ul li a').each(function(i,a) {
      if ($(a).text() == d.text && $(a).attr('class') == d.className) {
        $(a).addClass('selected')
      }
      })
    },

    _getActions: function() {
      $.ajax({
      url: 'data.json',
      success: this.render,
      error: function() {
        cdb.log.info('oh no!, check your json location or if you are using a web server (Apache?)')
      }
      })
    }
  })

    </script>
  </body>
</html>